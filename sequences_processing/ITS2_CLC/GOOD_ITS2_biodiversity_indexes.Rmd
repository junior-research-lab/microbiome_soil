---
title: "ITS2_biodiversity_indexes"
author: "JRL"
date: "15/06/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(purrr)
library(openxlsx)
library(tidyverse)
library(vegan)
library(readr)
library(readxl)
library(plyr)
library(dplyr)
library(utils)
library(estimatr)
library(ggpubr)
library(iNEXT)
library(acepack)
```

```{r import tables}
df_phylum <- read_excel("C:/Users/amapo/Documents/GitHub/microbiome_soil/sequences_processing/ITS2_CLC/ITS2_phylum_reads.xlsx")
df_order <- read_excel("C:/Users/amapo/Documents/GitHub/microbiome_soil/sequences_processing/ITS2_CLC/ITS2_order_reads.xlsx")
df_family <- read_excel("C:/Users/amapo/Documents/GitHub/microbiome_soil/sequences_processing/ITS2_CLC/ITS2_family_reads.xlsx")
df_gender <- read_excel("C:/Users/amapo/Documents/GitHub/microbiome_soil/sequences_processing/ITS2_CLC/ITS2_gender_reads.xlsx")

# Import the S1 table

S1_table <- read_excel("C:/Users/amapo/Documents/GitHub/microbiome_soil/sequences_processing/ITS2_CLC/S1_table.xlsx")
View(S1_table)

# Change format to .csv

write.csv(S1_table, file = "S1_table.csv", row.names = TRUE)

#Delete the same samples as ITS2

S1_table_ITS2 <- S1_table[-c(3, 4, 10, 18, 24), ]

```


```{r phylum}

#### Phylum of ITS2 ####


# Shannon for Phylum of ITS2

shannon_phylum_ITS2 <- ddply(df_phylum,~Samples,function(x) {
  data.frame(SHANNON=diversity(x[-1], index = "shannon"))
})
write.csv(shannon_phylum_ITS2, file = "shannon_phylum_ITS2.csv", row.names = TRUE)


# Simpson for Phylum of ITS2

simpson_phylum_ITS2 <- ddply(df_phylum,~Samples,function(x) {
  data.frame(SIMPSON=diversity(x[-1], index = "simpson"))
})
write.csv(simpson_phylum_ITS2, file = "simpson_phylum_ITS2.csv", row.names = TRUE)


# Chao1 for Phylum of ITS2

chao_phylum_ITS2 <- ddply(df_phylum,~Samples,function(x) {
  data.frame(chao1=estimateR(x[-1], index = "chao1"))
})
View(chao_phylum_ITS2)
write.csv(chao_phylum_ITS2, file = "chao1_phylum_ITS2.csv", row.names = TRUE)


# Merge biodiversity indexes

bi_phylum_ITS2 <- merge(shannon_phylum_ITS2, simpson_phylum_ITS2, by = "Samples")


# Export the merged table in excel and .csv

write.xlsx(bi_phylum_ITS2,"bi_phylum_ITS2.xlsx")
write.csv(bi_phylum_ITS2, file = "bi_phylum_ITS2.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#Merge bi and S1 tables
data_phylum_ITS2 <- merge(bi_phylum_ITS2, S1_table_ITS2, by = "Samples")


# Spearman correlation for SHANNON

corr_phy_ITS2_shann <- cor.test(x=data_phylum_ITS2$`ECe _values`, y=data_phylum_ITS2$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_phy_ITS2_shann

# Manually calculating

phy.ranked.shann <- data.frame(cbind(rank(data_phylum_ITS2$`ECe _values`, ties.method = "average"), rank(data_phylum_ITS2$SHANNON, ties.method = "average")))

colnames(phy.ranked.shann) <- c("ECe_values", "SHANNON")

rho <- cov(phy.ranked.shann) / (sd(phy.ranked.shann$ECe_values) * sd(phy.ranked.shann$SHANNON))

rho[[2]]

corr_phy_ITS2_shann$estimate

corr_phy_ITS2_shann$statistic

corr_phy_ITS2_shann$p.value

# Plot SHANNON for ITS2

ggscatter(phy.ranked.shann, x = "ECe_values", y = "SHANNON",
            color = "black", shape = 21, size = 3,
            add = "reg.line", add.params = list(color = "blue", fill = "lightgray"),
            conf.int = TRUE,
            cor.coef = TRUE,
            cor.method = "spearman",
            xlab = "ECe_value", ylab = "SHANNON") + geom_point()



# Spearman correlation for SIMPSON

corr_phy_ITS2_sim <- cor.test(x=data_phylum_ITS2$`ECe _values`, y=data_phylum_ITS2$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_phy_ITS2_sim

# Manually calculating

phy.ranked.sim <- data.frame(cbind(rank(data_phylum_ITS2$`ECe _values`, ties.method = "average"), rank(data_phylum_ITS2$SIMPSON, ties.method = "average")))

colnames(phy.ranked.sim) <- c("ECe_values", "SIMPSON")

rho <- cov(phy.ranked.sim) / (sd(phy.ranked.sim$ECe_values) * sd(phy.ranked.sim$SIMPSON))

rho[[2]]

corr_phy_ITS2_sim$estimate

corr_phy_ITS2_sim$statistic

corr_phy_ITS2_sim$p.value



#### Only for bulk samples ####

bi_phylum_ITS2_B <- merge(shannon_phylum_ITS2, simpson_phylum_ITS2, by = "Samples") %>% slice(1:19)

# Export the merged table in excel and .csv

write.xlsx(bi_phylum_ITS2_B,"bi_phylum_ITS2_B.xlsx")
write.csv(bi_phylum_ITS2_B, file = "bi_phylum_ITS2_B.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#S1 table for bulk samples
S1_table_ITS2_B <- S1_table %>% slice(1:19)

#Merge bi and S1 tables
data_phylum_ITS2_B <- merge(bi_phylum_ITS2_B, S1_table_ITS2_B, by = "Samples")


# Spearman correlation for SHANNON

corr_phy_ITS2_shann_B <- cor.test(x=data_phylum_ITS2_B$`ECe _values`, y=data_phylum_ITS2_B$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_phy_ITS2_shann_B

# Manually calculating

phy.ranked.shann_B <- data.frame(cbind(rank(data_phylum_ITS2_B$`ECe _values`, ties.method = "average"), rank(data_phylum_ITS2_B$SHANNON, ties.method = "average")))

colnames(phy.ranked.shann_B) <- c("ECe_values", "SHANNON")

rho <- cov(phy.ranked.shann_B) / (sd(phy.ranked.shann_B$ECe_values) * sd(phy.ranked.shann_B$SHANNON))

rho[[2]]

corr_phy_ITS2_shann_B$estimate

corr_phy_ITS2_shann_B$statistic

corr_phy_ITS2_shann_B$p.value


# Spearman correlation for SIMPSON

corr_phy_ITS2_sim_B <- cor.test(x=data_phylum_ITS2_B$`ECe _values`, y=data_phylum_ITS2_B$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_phy_ITS2_sim_B

# Manually calculating

phy.ranked.sim_B <- data.frame(cbind(rank(data_phylum_ITS2_B$`ECe _values`, ties.method = "average"), rank(data_phylum_ITS2_B$SIMPSON, ties.method = "average")))

colnames(phy.ranked.sim_B) <- c("ECe_values", "SIMPSON")

rho <- cov(phy.ranked.sim_B) / (sd(phy.ranked.sim_B$ECe_values) * sd(phy.ranked.sim_B$SIMPSON))

rho[[2]]

corr_phy_ITS2_sim_B$estimate

corr_phy_ITS2_sim_B$statistic

corr_phy_ITS2_sim_B$p.value


#### Only for rhizospheric samples ####

bi_phylum_ITS2_R <- merge(shannon_phylum_ITS2, simpson_phylum_ITS2, by = "Samples") %>% slice(20:42)
View(bi_phylum_ITS2_R)

# Export the merged table in excel and .csv

write.xlsx(bi_phylum_ITS2_R,"bi_phylum_ITS2_R.xlsx")
write.csv(bi_phylum_ITS2_R, file = "bi_phylum_ITS2_R.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#S1 table for rhizosphere samples
S1_table_ITS2_R <- S1_table %>% slice(20:42)

#Merge bi and S1 tables
data_phylum_ITS2_R <- merge(bi_phylum_ITS2_R, S1_table_ITS2_R, by = "Samples")
View(data_phylum_ITS2_R)

# Spearman correlation for SHANNON

corr_phy_ITS2_shann_R <- cor.test(x=data_phylum_ITS2_R$`ECe _values`, y=data_phylum_ITS2_R$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_phy_ITS2_shann_R

# Manually calculating

phy.ranked.shann_R <- data.frame(cbind(rank(data_phylum_ITS2_R$`ECe _values`, ties.method = "average"), rank(data_phylum_ITS2_R$SHANNON, ties.method = "average")))

colnames(phy.ranked.shann_R) <- c("ECe_values", "SHANNON")

rho <- cov(phy.ranked.shann_R) / (sd(phy.ranked.shann_R$ECe_values) * sd(phy.ranked.shann_R$SHANNON))

rho[[2]]

corr_phy_ITS2_shann_R$estimate

corr_phy_ITS2_shann_R$statistic

corr_phy_ITS2_shann_R$p.value


# Spearman correlation for SIMPSON

corr_phy_ITS2_sim_R <- cor.test(x=data_phylum_ITS2_R$`ECe _values`, y=data_phylum_ITS2_R$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_phy_ITS2_sim_R

# Manually calculating

phy.ranked.sim_R <- data.frame(cbind(rank(data_phylum_ITS2_R$`ECe _values`, ties.method = "average"), rank(data_phylum_ITS2_R$SIMPSON, ties.method = "average")))

colnames(phy.ranked.sim_R) <- c("ECe_values", "SIMPSON")

rho <- cov(phy.ranked.sim_R) / (sd(phy.ranked.sim_R$ECe_values) * sd(phy.ranked.sim_R$SIMPSON))

rho[[2]]

corr_phy_ITS2_sim_R$estimate

corr_phy_ITS2_sim_R$statistic

corr_phy_ITS2_sim_R$p.value



### Kruskal-Wallis test ###

# Phylum ITS2 SHANNON in bulk samples

kruskal.test(ECe_values~SHANNON, data = phy.ranked.shann_B)

# Phylum ITS2 SIMPSON in bulk samples

kruskal.test(ECe_values~SIMPSON, data = phy.ranked.sim_B)

# Phylum ITS2 SHANNON in rhizospheric samples

kruskal.test(ECe_values~SHANNON, data = phy.ranked.shann_R)

# Phylum ITS2 SIMPSON in rhizospheric samples

kruskal.test(ECe_values~SIMPSON, data = phy.ranked.sim_R)




```
```{r}


```
```{r}

```

```{r order}

# Order of ITS2

# Shannon for Order of ITS2

shannon_order_ITS2 <- ddply(df_order,~Samples,function(x) {
  data.frame(SHANNON=diversity(x[-1], index = "shannon"))
})
write.csv(shannon_order_ITS2, file = "shannon_order_ITS2.csv", row.names = TRUE)

# Simpson for Order of ITS2

simpson_order_ITS2 <- ddply(df_order,~Samples,function(x) {
  data.frame(SIMPSON=diversity(x[-1], index = "simpson"))
})
write.csv(simpson_order_ITS2, file = "simpson_order_ITS2.csv", row.names = TRUE)

# Chao1 for Order of ITS2

chao_order_ITS2 <- ddply(df_order,~Samples,function(x) {
  data.frame(chao1=estimateR(x[-1], index = "chao1"))
})
View(chao_order_ITS2)
write.csv(chao_order_ITS2, file = "chao1_order_ITS2.csv", row.names = TRUE)



# Merge biodiversity indexes

bi_order_ITS2 <- merge(shannon_order_ITS2, simpson_order_ITS2, by = "Samples")


# Export the merged table in excel and .csv

write.xlsx(bi_order_ITS2,"bi_order_ITS2.xlsx")
write.csv(bi_order_ITS2, file = "bi_order_ITS2.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#Merge bi and S1 tables
data_order_ITS2 <- merge(bi_order_ITS2, S1_table_ITS2, by = "Samples")


# Spearman correlation for SHANNON

corr_order_ITS2_shann <- cor.test(x=data_order_ITS2$`ECe _values`, y=data_order_ITS2$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_order_ITS2_shann

# Manually calculating

order.ranked.shann <- data.frame(cbind(rank(data_order_ITS2$`ECe _values`, ties.method = "average"), rank(data_order_ITS2$SHANNON, ties.method = "average")))

colnames(order.ranked.shann) <- c("ECe_values", "SHANNON")

rho <- cov(order.ranked.shann) / (sd(order.ranked.shann$ECe_values) * sd(order.ranked.shann$SHANNON))

rho[[2]]

corr_order_ITS2_shann$estimate

corr_order_ITS2_shann$statistic

corr_order_ITS2_shann$p.value


# Spearman correlation for SIMPSON

corr_order_ITS2_sim <- cor.test(x=data_order_ITS2$`ECe _values`, y=data_order_ITS2$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_order_ITS2_sim

# Manually calculating

order.ranked.sim <- data.frame(cbind(rank(data_order_ITS2$`ECe _values`, ties.method = "average"), rank(data_order_ITS2$SIMPSON, ties.method = "average")))

colnames(order.ranked.sim) <- c("ECe_values", "SIMPSON")

rho <- cov(order.ranked.sim) / (sd(order.ranked.sim$ECe_values) * sd(order.ranked.sim$SIMPSON))

rho[[2]]

corr_order_ITS2_sim$estimate

corr_order_ITS2_sim$statistic

corr_order_ITS2_sim$p.value


#### Only for bulk samples ####

bi_order_ITS2_B <- merge(shannon_order_ITS2, simpson_order_ITS2, by = "Samples") %>% slice(1:19)

# Export the merged table in excel and .csv

write.xlsx(bi_order_ITS2_B,"bi_order_ITS2_B.xlsx")
write.csv(bi_order_ITS2_B, file = "bi_order_ITS2_B.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#S1 table for bulk samples
S1_table_ITS2_B <- S1_table %>% slice(1:19)

#Merge bi and S1 tables
data_order_ITS2_B <- merge(bi_order_ITS2_B, S1_table_ITS2_B, by = "Samples")


# Spearman correlation for SHANNON

corr_ord_ITS2_shann_B <- cor.test(x=data_order_ITS2_B$`ECe _values`, y=data_order_ITS2_B$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_ord_ITS2_shann_B

# Manually calculating

ord.ranked.shann_B <- data.frame(cbind(rank(data_order_ITS2_B$`ECe _values`, ties.method = "average"), rank(data_order_ITS2_B$SHANNON, ties.method = "average")))

colnames(ord.ranked.shann_B) <- c("ECe_values", "SHANNON")

rho <- cov(ord.ranked.shann_B) / (sd(ord.ranked.shann_B$ECe_values) * sd(ord.ranked.shann_B$SHANNON))

rho[[2]]

corr_ord_ITS2_shann_B$estimate

corr_ord_ITS2_shann_B$statistic

corr_ord_ITS2_shann_B$p.value


# Spearman correlation for SIMPSON

corr_ord_ITS2_sim_B <- cor.test(x=data_order_ITS2_B$`ECe _values`, y=data_order_ITS2_B$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_ord_ITS2_sim_B

# Manually calculating

ord.ranked.sim_B <- data.frame(cbind(rank(data_order_ITS2_B$`ECe _values`, ties.method = "average"), rank(data_order_ITS2_B$SIMPSON, ties.method = "average")))

colnames(ord.ranked.sim_B) <- c("ECe_values", "SIMPSON")

rho <- cov(ord.ranked.sim_B) / (sd(ord.ranked.sim_B$ECe_values) * sd(ord.ranked.sim_B$SIMPSON))

rho[[2]]

corr_ord_ITS2_sim_B$estimate

corr_ord_ITS2_sim_B$statistic

corr_ord_ITS2_sim_B$p.value


#### Only for rhizospheric samples ####

bi_order_ITS2_R <- merge(shannon_order_ITS2, simpson_order_ITS2, by = "Samples") %>% slice(20:42)
View(bi_order_ITS2_R)

# Export the merged table in excel and .csv

write.xlsx(bi_order_ITS2_R,"bi_order_ITS2_R.xlsx")
write.csv(bi_order_ITS2_R, file = "bi_order_ITS2_R.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#S1 table for rhizosphere samples
S1_table_ITS2_R <- S1_table %>% slice(20:42)

#Merge bi and S1 tables
data_order_ITS2_R <- merge(bi_order_ITS2_R, S1_table_ITS2_R, by = "Samples")


# Spearman correlation for SHANNON

corr_ord_ITS2_shann_R <- cor.test(x=data_order_ITS2_R$`ECe _values`, y=data_order_ITS2_R$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_ord_ITS2_shann_R

# Manually calculating

ord.ranked.shann_R <- data.frame(cbind(rank(data_order_ITS2_R$`ECe _values`, ties.method = "average"), rank(data_order_ITS2_R$SHANNON, ties.method = "average")))

colnames(ord.ranked.shann_R) <- c("ECe_values", "SHANNON")

rho <- cov(ord.ranked.shann_R) / (sd(ord.ranked.shann_R$ECe_values) * sd(ord.ranked.shann_R$SHANNON))

rho[[2]]

corr_ord_ITS2_shann_R$estimate

corr_ord_ITS2_shann_R$statistic

corr_ord_ITS2_shann_R$p.value


# Spearman correlation for SIMPSON

corr_ord_ITS2_sim_R <- cor.test(x=data_order_ITS2_R$`ECe _values`, y=data_order_ITS2_R$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_ord_ITS2_sim_R

# Manually calculating

ord.ranked.sim_R <- data.frame(cbind(rank(data_order_ITS2_R$`ECe _values`, ties.method = "average"), rank(data_order_ITS2_R$SIMPSON, ties.method = "average")))

colnames(ord.ranked.sim_R) <- c("ECe_values", "SIMPSON")

rho <- cov(ord.ranked.sim_R) / (sd(ord.ranked.sim_R$ECe_values) * sd(ord.ranked.sim_R$SIMPSON))

rho[[2]]

corr_ord_ITS2_sim_R$estimate

corr_ord_ITS2_sim_R$statistic

corr_ord_ITS2_sim_R$p.value



### Kruskal-Wallis test ###

# Order ITS2 SHANNON in bulk samples

kruskal.test(ECe_values~SHANNON, data = ord.ranked.shann_B)

# Order ITS2 SIMPSON in bulk samples

kruskal.test(ECe_values~SIMPSON, data = ord.ranked.sim_B)

# Order ITS2 SHANNON in rhizospheric samples

kruskal.test(ECe_values~SHANNON, data = ord.ranked.shann_R)

# Order ITS2 SIMPSON in rhizospheric samples

kruskal.test(ECe_values~SIMPSON, data = ord.ranked.sim_R)

```

```{r family}
# Family of ITS2

# Shannon for Family of ITS2

shannon_family_ITS2 <- ddply(df_family,~Samples,function(x) {
  data.frame(SHANNON=diversity(x[-1], index = "shannon"))
})
write.csv(shannon_family_ITS2, file = "shannon_family_ITS2.csv", row.names = TRUE)

# Simpson for Family of ITS2

simpson_family_ITS2 <- ddply(df_family,~Samples,function(x) {
  data.frame(SIMPSON=diversity(x[-1], index = "simpson"))
})
write.csv(simpson_family_ITS2, file = "simpson_family_ITS2.csv", row.names = TRUE)

# Chao1 for Family of ITS2

chao_family_ITS2 <- ddply(df_family,~Samples,function(x) {
  data.frame(chao1=estimateR(x[-1], index = "chao1"))
})
View(chao_family_ITS2)
write.csv(chao_family_ITS2, file = "chao1_family_ITS2.csv", row.names = TRUE)


# Merge biodiversity indexes

bi_family_ITS2 <- merge(shannon_family_ITS2, simpson_family_ITS2, by = "Samples")


# Export the merged table in excel and .csv

write.xlsx(bi_family_ITS2,"bi_family_ITS2.xlsx")
write.csv(bi_family_ITS2, file = "bi_family_ITS2.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#Merge bi and S1 tables
data_family_ITS2 <- merge(bi_family_ITS2, S1_table_ITS2, by = "Samples")


# Spearman correlation for SHANNON

corr_family_ITS2_shann <- cor.test(x=data_family_ITS2$`ECe _values`, y=data_family_ITS2$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_family_ITS2_shann

# Manually calculating

family.ranked.shann <- data.frame(cbind(rank(data_family_ITS2$`ECe _values`, ties.method = "average"), rank(data_family_ITS2$SHANNON, ties.method = "average")))

colnames(family.ranked.shann) <- c("ECe_values", "SHANNON")

rho <- cov(family.ranked.shann) / (sd(family.ranked.shann$ECe_values) * sd(family.ranked.shann$SHANNON))

rho[[2]]

corr_family_ITS2_shann$estimate

corr_family_ITS2_shann$statistic

corr_family_ITS2_shann$p.value


# Spearman correlation for SIMPSON

corr_family_ITS2_sim <- cor.test(x=data_family_ITS2$`ECe _values`, y=data_family_ITS2$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_family_ITS2_sim

# Manually calculating

family.ranked.sim <- data.frame(cbind(rank(data_family_ITS2$`ECe _values`, ties.method = "average"), rank(data_family_ITS2$SIMPSON, ties.method = "average")))

colnames(family.ranked.sim) <- c("ECe_values", "SIMPSON")

rho <- cov(family.ranked.sim) / (sd(family.ranked.sim$ECe_values) * sd(family.ranked.sim$SIMPSON))

rho[[2]]

corr_family_ITS2_sim$estimate

corr_family_ITS2_sim$statistic

corr_family_ITS2_sim$p.value



#### Only for bulk samples ####

bi_family_ITS2_B <- merge(shannon_family_ITS2, simpson_family_ITS2, by = "Samples") %>% slice(1:19)

# Export the merged table in excel and .csv

write.xlsx(bi_family_ITS2_B,"bi_family_ITS2_B.xlsx")
write.csv(bi_family_ITS2_B, file = "bi_family_ITS2_B.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#S1 table for bulk samples
S1_table_ITS2_B <- S1_table_ITS2 %>% slice(1:19)

#Merge bi and S1 tables
data_family_ITS2_B <- merge(bi_family_ITS2_B, S1_table_ITS2_B, by = "Samples")


# Spearman correlation for SHANNON

corr_fam_ITS2_shann_B <- cor.test(x=data_family_ITS2_B$`ECe _values`, y=data_family_ITS2_B$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_fam_ITS2_shann_B

# Manually calculating

fam.ranked.shann_B <- data.frame(cbind(rank(data_family_ITS2_B$`ECe _values`, ties.method = "average"), rank(data_family_ITS2_B$SHANNON, ties.method = "average")))

colnames(fam.ranked.shann_B) <- c("ECe_values", "SHANNON")

rho <- cov(fam.ranked.shann_B) / (sd(fam.ranked.shann_B$ECe_values) * sd(fam.ranked.shann_B$SHANNON))

rho[[2]]

corr_fam_ITS2_shann_B$estimate

corr_fam_ITS2_shann_B$statistic

corr_fam_ITS2_shann_B$p.value


# Spearman correlation for SIMPSON

corr_fam_ITS2_sim_B <- cor.test(x=data_family_ITS2_B$`ECe _values`, y=data_family_ITS2_B$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_fam_ITS2_sim_B

# Manually calculating

fam.ranked.sim_B <- data.frame(cbind(rank(data_family_ITS2_B$`ECe _values`, ties.method = "average"), rank(data_family_ITS2_B$SIMPSON, ties.method = "average")))

colnames(fam.ranked.sim_B) <- c("ECe_values", "SIMPSON")

rho <- cov(fam.ranked.sim_B) / (sd(fam.ranked.sim_B$ECe_values) * sd(fam.ranked.sim_B$SIMPSON))

rho[[2]]

corr_fam_ITS2_sim_B$estimate

corr_fam_ITS2_sim_B$statistic

corr_fam_ITS2_sim_B$p.value


#### Only for rhizospheric samples ####

bi_family_ITS2_R <- merge(shannon_family_ITS2, simpson_family_ITS2, by = "Samples") %>% slice(20:42)
View(bi_family_ITS2_R)

# Export the merged table in excel and .csv

write.xlsx(bi_family_ITS2_R,"bi_family_ITS2_R.xlsx")
write.csv(bi_family_ITS2_R, file = "bi_family_ITS2_R.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#S1 table for rhizosphere samples
S1_table_ITS2_R <- S1_table_ITS2 %>% slice(20:42)

#Merge bi and S1 tables
data_family_ITS2_R <- merge(bi_family_ITS2_R, S1_table_ITS2_R, by = "Samples")


# Spearman correlation for SHANNON

corr_fam_ITS2_shann_R <- cor.test(x=data_family_ITS2_R$`ECe _values`, y=data_family_ITS2_R$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_fam_ITS2_shann_R

# Manually calculating

fam.ranked.shann_R <- data.frame(cbind(rank(data_family_ITS2_R$`ECe _values`, ties.method = "average"), rank(data_family_ITS2_R$SHANNON, ties.method = "average")))

colnames(fam.ranked.shann_R) <- c("ECe_values", "SHANNON")

rho <- cov(fam.ranked.shann_R) / (sd(fam.ranked.shann_R$ECe_values) * sd(fam.ranked.shann_R$SHANNON))

rho[[2]]

corr_fam_ITS2_shann_R$estimate

corr_fam_ITS2_shann_R$statistic

corr_fam_ITS2_shann_R$p.value


# Spearman correlation for SIMPSON

corr_fam_ITS2_sim_R <- cor.test(x=data_family_ITS2_R$`ECe _values`, y=data_family_ITS2_R$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_fam_ITS2_sim_R

# Manually calculating

fam.ranked.sim_R <- data.frame(cbind(rank(data_family_ITS2_R$`ECe _values`, ties.method = "average"), rank(data_family_ITS2_R$SIMPSON, ties.method = "average")))

colnames(fam.ranked.sim_R) <- c("ECe_values", "SIMPSON")

rho <- cov(fam.ranked.sim_R) / (sd(fam.ranked.sim_R$ECe_values) * sd(fam.ranked.sim_R$SIMPSON))

rho[[2]]

corr_fam_ITS2_sim_R$estimate

corr_fam_ITS2_sim_R$statistic

corr_fam_ITS2_sim_R$p.value



### Kruskal-Wallis test ###

# Family ITS2 SHANNON in bulk samples

kruskal.test(ECe_values~SHANNON, data = fam.ranked.shann_B)

# Family ITS2 SIMPSON in bulk samples

kruskal.test(ECe_values~SIMPSON, data = fam.ranked.sim_B)

# Family ITS2 SHANNON in rhizospheric samples

kruskal.test(ECe_values~SHANNON, data = fam.ranked.shann_R)

# Family ITS2 SIMPSON in rhizospheric samples

kruskal.test(ECe_values~SIMPSON, data = fam.ranked.sim_R)
```

```{r gender}
# Gender of ITS2

# Shannon for Gender of ITS2

shannon_gender_ITS2 <- ddply(df_gender,~Samples,function(x) {
  data.frame(SHANNON=diversity(x[-1], index = "shannon"))
})
write.csv(shannon_gender_ITS2, file = "shannon_gender_ITS2.csv", row.names = TRUE)

# Simpson for Gender of ITS2

simpson_gender_ITS2 <- ddply(df_gender,~Samples,function(x) {
  data.frame(SIMPSON=diversity(x[-1], index = "simpson"))
})
write.csv(simpson_gender_ITS2, file = "simpson_gender_ITS2.csv", row.names = TRUE)

# Chao1 for Gender of ITS2

chao_gender_ITS2 <- ddply(df_gender,~Samples,function(x) {
  data.frame(chao1=estimateR(x[-1], index = "chao1"))
})
View(chao_gender_ITS2)
write.csv(chao_gender_ITS2, file = "chao1_gender_ITS2.csv", row.names = TRUE)



# Merge biodiversity indexes

bi_gender_ITS2 <- merge(shannon_gender_ITS2, simpson_gender_ITS2, by = "Samples")


# Export the merged table in excel and .csv

write.xlsx(bi_gender_ITS2,"bi_gender_ITS2.xlsx")
write.csv(bi_gender_ITS2, file = "bi_gender_ITS2.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#Merge bi and S1 tables
data_gender_ITS2 <- merge(bi_gender_ITS2, S1_table_ITS2, by = "Samples")


# Spearman correlation for SHANNON

corr_gender_ITS2_shann <- cor.test(x=data_gender_ITS2$`ECe _values`, y=data_gender_ITS2$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_gender_ITS2_shann

# Manually calculating

gender.ranked.shann <- data.frame(cbind(rank(data_gender_ITS2$`ECe _values`, ties.method = "average"), rank(data_gender_ITS2$SHANNON, ties.method = "average")))

colnames(gender.ranked.shann) <- c("ECe_values", "SHANNON")

rho <- cov(gender.ranked.shann) / (sd(gender.ranked.shann$ECe_values) * sd(gender.ranked.shann$SHANNON))

rho[[2]]

corr_gender_ITS2_shann$estimate

corr_gender_ITS2_shann$statistic

corr_gender_ITS2_shann$p.value


# Spearman correlation for SIMPSON

corr_gender_ITS2_sim <- cor.test(x=data_gender_ITS2$`ECe _values`, y=data_gender_ITS2$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_gender_ITS2_sim

# Manually calculating

gender.ranked.sim <- data.frame(cbind(rank(data_gender_ITS2$`ECe _values`, ties.method = "average"), rank(data_gender_ITS2$SIMPSON, ties.method = "average")))

colnames(gender.ranked.sim) <- c("ECe_values", "SIMPSON")

rho <- cov(gender.ranked.sim) / (sd(gender.ranked.sim$ECe_values) * sd(gender.ranked.sim$SIMPSON))

rho[[2]]

corr_gender_ITS2_sim$estimate

corr_gender_ITS2_sim$statistic

corr_gender_ITS2_sim$p.value



#### Only for bulk samples ####

bi_gender_ITS2_B <- merge(shannon_gender_ITS2, simpson_gender_ITS2, by = "Samples") %>% slice(1:19)

# Export the merged table in excel and .csv

write.xlsx(bi_gender_ITS2_B,"bi_gender_ITS2_B.xlsx")
write.csv(bi_gender_ITS2_B, file = "bi_gender_ITS2_B.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#S1 table for bulk samples
S1_table_ITS2_B <- S1_table_ITS2 %>% slice(1:19)

#Merge bi and S1 tables
data_gender_ITS2_B <- merge(bi_gender_ITS2_B, S1_table_ITS2_B, by = "Samples")


# Spearman correlation for SHANNON

corr_gen_ITS2_shann_B <- cor.test(x=data_gender_ITS2_B$`ECe _values`, y=data_gender_ITS2_B$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_gen_ITS2_shann_B

# Manually calculating

gen.ranked.shann_B <- data.frame(cbind(rank(data_gender_ITS2_B$`ECe _values`, ties.method = "average"), rank(data_gender_ITS2_B$SHANNON, ties.method = "average")))

colnames(gen.ranked.shann_B) <- c("ECe_values", "SHANNON")

rho <- cov(gen.ranked.shann_B) / (sd(gen.ranked.shann_B$ECe_values) * sd(gen.ranked.shann_B$SHANNON))

rho[[2]]

corr_gen_ITS2_shann_B$estimate

corr_gen_ITS2_shann_B$statistic

corr_gen_ITS2_shann_B$p.value


# Spearman correlation for SIMPSON

corr_gen_ITS2_sim_B <- cor.test(x=data_gender_ITS2_B$`ECe _values`, y=data_gender_ITS2_B$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_gen_ITS2_sim_B

# Manually calculating

gen.ranked.sim_B <- data.frame(cbind(rank(data_gender_ITS2_B$`ECe _values`, ties.method = "average"), rank(data_gender_ITS2_B$SIMPSON, ties.method = "average")))

colnames(gen.ranked.sim_B) <- c("ECe_values", "SIMPSON")

rho <- cov(gen.ranked.sim_B) / (sd(gen.ranked.sim_B$ECe_values) * sd(gen.ranked.sim_B$SIMPSON))

rho[[2]]

corr_gen_ITS2_sim_B$estimate

corr_gen_ITS2_sim_B$statistic

corr_gen_ITS2_sim_B$p.value


#### Only for rhizospheric samples ####

bi_gender_ITS2_R <- merge(shannon_gender_ITS2, simpson_gender_ITS2, by = "Samples") %>% slice(20:42)
View(bi_gender_ITS2_R)

# Export the merged table in excel and .csv

write.xlsx(bi_gender_ITS2_R,"bi_gender_ITS2_R.xlsx")
write.csv(bi_gender_ITS2_R, file = "bi_gender_ITS2_R.csv", row.names = TRUE)


# Preparation of data for Spearman correlation

#S1 table for rhizosphere samples
S1_table_ITS2_R <- S1_table_ITS2 %>% slice(20:42)

#Merge bi and S1 tables
data_gender_ITS2_R <- merge(bi_gender_ITS2_R, S1_table_ITS2_R, by = "Samples")


# Spearman correlation for SHANNON

corr_gen_ITS2_shann_R <- cor.test(x=data_gender_ITS2_R$`ECe _values`, y=data_gender_ITS2_R$SHANNON, method = "spearman")

#Cannot compute exact p-value with ties

corr_gen_ITS2_shann_R

# Manually calculating

gen.ranked.shann_R <- data.frame(cbind(rank(data_gender_ITS2_R$`ECe _values`, ties.method = "average"), rank(data_gender_ITS2_R$SHANNON, ties.method = "average")))

colnames(gen.ranked.shann_R) <- c("ECe_values", "SHANNON")

rho <- cov(gen.ranked.shann_R) / (sd(gen.ranked.shann_R$ECe_values) * sd(gen.ranked.shann_R$SHANNON))

rho[[2]]

corr_gen_ITS2_shann_R$estimate

corr_gen_ITS2_shann_R$statistic

corr_gen_ITS2_shann_R$p.value


# Spearman correlation for SIMPSON

corr_gen_ITS2_sim_R <- cor.test(x=data_gender_ITS2_R$`ECe _values`, y=data_gender_ITS2_R$SIMPSON, method = "spearman")

#Cannot compute exact p-value with ties

corr_gen_ITS2_sim_R

# Manually calculating

gen.ranked.sim_R <- data.frame(cbind(rank(data_gender_ITS2_R$`ECe _values`, ties.method = "average"), rank(data_gender_ITS2_R$SIMPSON, ties.method = "average")))

colnames(gen.ranked.sim_R) <- c("ECe_values", "SIMPSON")

rho <- cov(gen.ranked.sim_R) / (sd(gen.ranked.sim_R$ECe_values) * sd(gen.ranked.sim_R$SIMPSON))

rho[[2]]

corr_gen_ITS2_sim_R$estimate

corr_gen_ITS2_sim_R$statistic

corr_gen_ITS2_sim_R$p.value



### Kruskal-Wallis test ###

# Gender ITS2 SHANNON in bulk samples

kruskal.test(ECe_values~SHANNON, data = gen.ranked.shann_B)

# Gender ITS2 SIMPSON in bulk samples

kruskal.test(ECe_values~SIMPSON, data = gen.ranked.sim_B)

# Gender ITS2 SHANNON in rhizospheric samples

kruskal.test(ECe_values~SHANNON, data = gen.ranked.shann_R)

# Gender ITS2 SIMPSON in rhizospheric samples

kruskal.test(ECe_values~SIMPSON, data = gen.ranked.sim_R)
```
```


```{r}
# Phylum

total_phylum <- rbind(shannon_phylum_ITS2, simpson_phylum_ITS2, chao_phylum_ITS2)
t_total_phylum <- data.frame(t(total_phylum))
View(t_total_phylum)

# Order

total_order <- rbind(shannon_order_ITS2, simpson_order_ITS2, chao_order_ITS2)
t_total_order <- data.frame(t(total_order))
View(t_total_order)

# Family

total_family <- rbind(shannon_family_ITS2, simpson_family_ITS2, chao_family_ITS2)
t_total_family <- data.frame(t(total_family))
View(t_total_family)

# Gender

total_gender <- rbind(shannon_gender_ITS2, simpson_gender_ITS2, chao_gender_ITS2)
t_total_gender <- data.frame(t(total_gender))
View(t_total_gender)

```

